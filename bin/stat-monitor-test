require 'base64'
require 'digest/md5'
require 'json'
require 'openssl'
require 'socket'

privateKey = OpenSSL::PKey::RSA.new File.read '/etc/stat-monitor-client/private_key.pem'

encrypted = privateKey.private_encrypt(Time.new.to_i.to_s)
checksum = Digest::MD5.digest(encrypted)
message = Base64.encode64(checksum + encrypted).gsub(/\n/, "")



socket = TCPSocket.open('127.0.0.1', 9445)
socket.puts(message)

puts socket.gets unless socket.closed?

